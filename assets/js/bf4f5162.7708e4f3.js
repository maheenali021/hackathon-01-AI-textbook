"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_book=globalThis.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[383],{6509:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"module1/services-actions-control","title":"Chapter 5: Services and Actions for Robot Control","description":"Understanding Request-Response Communication","source":"@site/docs/module1/services-actions-control.md","sourceDirName":"module1","slug":"/module1/services-actions-control","permalink":"/hackathon-01-AI-textbook/docs/module1/services-actions-control","draft":false,"unlisted":false,"editUrl":"https://github.com/maheenali021/hackathon-01-AI-textbook/tree/main/docs/module1/services-actions-control.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Chapter 5: Services and Actions for Robot Control"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 4: Publishers and Subscribers in ROS 2","permalink":"/hackathon-01-AI-textbook/docs/module1/publishers-subscribers"},"next":{"title":"Chapter 6: Bridging Python Agents with ROS 2","permalink":"/hackathon-01-AI-textbook/docs/module1/bridging-python-agents"}}');var s=i(4848),t=i(8453);const o={sidebar_position:5,title:"Chapter 5: Services and Actions for Robot Control"},c="Services and Actions for Robot Control",l={},a=[{value:"Understanding Request-Response Communication",id:"understanding-request-response-communication",level:2},{value:"Services",id:"services",level:2},{value:"Service Definition",id:"service-definition",level:3},{value:"Service Server Implementation",id:"service-server-implementation",level:3},{value:"Service Client Implementation",id:"service-client-implementation",level:3},{value:"Actions",id:"actions",level:2},{value:"Action Definition",id:"action-definition",level:3},{value:"Action Server Implementation",id:"action-server-implementation",level:3},{value:"Action Client Implementation",id:"action-client-implementation",level:3},{value:"Robot Control Applications",id:"robot-control-applications",level:2},{value:"Movement Control with Services",id:"movement-control-with-services",level:3},{value:"Navigation with Actions",id:"navigation-with-actions",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Service Design",id:"service-design",level:3},{value:"Action Design",id:"action-design",level:3},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Hands-on Exercise",id:"hands-on-exercise",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"services-and-actions-for-robot-control",children:"Services and Actions for Robot Control"})}),"\n",(0,s.jsx)(n.h2,{id:"understanding-request-response-communication",children:"Understanding Request-Response Communication"}),"\n",(0,s.jsx)(n.p,{children:"Services and actions provide request-response communication patterns in ROS 2, essential for robot control and task execution."}),"\n",(0,s.jsx)(n.h2,{id:"services",children:"Services"}),"\n",(0,s.jsx)(n.h3,{id:"service-definition",children:"Service Definition"}),"\n",(0,s.jsxs)(n.p,{children:["Services provide synchronous request-response communication. Define services using ",(0,s.jsx)(n.code,{children:".srv"})," files:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"# AddTwoInts.srv\r\nint64 a\r\nint64 b\r\n---\r\nint64 sum\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-server-implementation",children:"Service Server Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass MinimalService(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Returning: {response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_service = MinimalService()\r\n    rclpy.spin(minimal_service)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-client-implementation",children:"Service Client Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass MinimalClient(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_client')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        self.future = self.cli.call_async(self.req)\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_client = MinimalClient()\r\n    response = minimal_client.send_request(1, 2)\r\n    minimal_client.get_logger().info(f'Result: {response.sum}')\r\n    minimal_client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,s.jsx)(n.h3,{id:"action-definition",children:"Action Definition"}),"\n",(0,s.jsxs)(n.p,{children:["Actions handle long-running tasks with feedback and goals. Define actions using ",(0,s.jsx)(n.code,{children:".action"})," files:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"# Fibonacci.action\r\nint32 order\r\n---\r\nint32[] sequence\r\n---\r\nint32[] partial_sequence\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-server-implementation",children:"Action Server Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass FibonacciActionServer(Node):\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_server')\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci',\r\n            self.execute_callback)\r\n\r\n    def execute_callback(self, goal_handle):\r\n        self.get_logger().info('Executing goal...')\r\n\r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.partial_sequence = [0, 1]\r\n\r\n        for i in range(1, goal_handle.request.order):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info('Goal canceled')\r\n                return Fibonacci.Result()\r\n\r\n            feedback_msg.partial_sequence.append(\r\n                feedback_msg.partial_sequence[i] + feedback_msg.partial_sequence[i-1])\r\n\r\n            goal_handle.publish_feedback(feedback_msg)\r\n            time.sleep(1)\r\n\r\n        goal_handle.succeed()\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.partial_sequence\r\n        return result\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    fibonacci_action_server = FibonacciActionServer()\r\n    rclpy.spin(fibonacci_action_server)\r\n    fibonacci_action_server.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-client-implementation",children:"Action Client Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass FibonacciActionClient(Node):\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_client')\r\n        self._action_client = ActionClient(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci')\r\n\r\n    def send_goal(self, order):\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = order\r\n\r\n        self._action_client.wait_for_server()\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback)\r\n\r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        goal_handle = future.result()\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info('Goal rejected')\r\n            return\r\n\r\n        self.get_logger().info('Goal accepted')\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f'Received feedback: {feedback.partial_sequence}')\r\n\r\n    def get_result_callback(self, future):\r\n        result = future.result().result\r\n        self.get_logger().info(f'Result: {result.sequence}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    action_client = FibonacciActionClient()\r\n    action_client.send_goal(10)\r\n    rclpy.spin(action_client)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"robot-control-applications",children:"Robot Control Applications"}),"\n",(0,s.jsx)(n.h3,{id:"movement-control-with-services",children:"Movement Control with Services"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Movement control service\r\nfrom geometry_msgs.msg import Twist\r\n\r\nclass MovementControlService(Node):\r\n    def __init__(self):\r\n        super().__init__('movement_control_service')\r\n        self.cmd_vel_publisher = self.create_publisher(Twist, '/cmd_vel', 10)\r\n        self.srv = self.create_service(\r\n            MovementCommand,\r\n            'move_robot',\r\n            self.move_callback)\r\n\r\n    def move_callback(self, request, response):\r\n        cmd = Twist()\r\n        cmd.linear.x = request.linear_speed\r\n        cmd.angular.z = request.angular_speed\r\n\r\n        self.cmd_vel_publisher.publish(cmd)\r\n        response.success = True\r\n        response.message = f'Moved with linear: {request.linear_speed}, angular: {request.angular_speed}'\r\n        return response\n"})}),"\n",(0,s.jsx)(n.h3,{id:"navigation-with-actions",children:"Navigation with Actions"}),"\n",(0,s.jsx)(n.p,{children:"Actions are ideal for navigation tasks that take time to complete:"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Use actions for navigation goals rather than services because navigation can take significant time and users may want periodic feedback on progress."})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"service-design",children:"Service Design"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Keep services for short, synchronous operations"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate error handling"}),"\n",(0,s.jsx)(n.li,{children:"Consider timeout values for clients"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"action-design",children:"Action Design"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use actions for long-running operations"}),"\n",(0,s.jsx)(n.li,{children:"Provide meaningful feedback messages"}),"\n",(0,s.jsx)(n.li,{children:"Handle cancellation requests properly"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Services block until completion"}),"\n",(0,s.jsx)(n.li,{children:"Actions provide non-blocking communication"}),"\n",(0,s.jsx)(n.li,{children:"Consider the impact of synchronous operations on system performance"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,s.jsx)(n.p,{children:"After completing this chapter, you will be able to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implement service servers and clients"}),"\n",(0,s.jsx)(n.li,{children:"Create and use action servers and clients"}),"\n",(0,s.jsx)(n.li,{children:"Choose appropriate communication patterns for robot control"}),"\n",(0,s.jsx)(n.li,{children:"Handle errors and timeouts in service and action communication"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"hands-on-exercise",children:"Hands-on Exercise"}),"\n",(0,s.jsx)(n.p,{children:"Create a robot control system using both services for immediate commands and actions for navigation tasks. Implement a client that uses both communication patterns."}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"ros2 service list"})," and ",(0,s.jsx)(n.code,{children:"ros2 action list"})," to discover available services and actions on your system."]})})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var r=i(6540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);