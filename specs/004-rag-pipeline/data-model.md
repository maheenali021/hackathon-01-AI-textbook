# Data Model: RAG Pipeline

## Entities

### BookContent
Represents the original book content extracted from the website, including chapters, sections, and text content.

**Fields**:
- `id` (string): Unique identifier for the source document
- `url` (string): Source URL of the content
- `title` (string): Chapter/section title
- `content` (string): Raw text content
- `metadata` (object): Additional information like chapter number, section hierarchy
- `created_at` (string): Timestamp when content was extracted
- `updated_at` (string): Timestamp when content was last modified

**Validation Rules**:
- `id` must be unique across all BookContent entities
- `url` must be a valid URL format
- `content` must not be empty
- `title` must not be empty

### ContentChunk
Represents a segment of book content that has been chunked according to the strategy, with metadata about its source location.

**Fields**:
- `id` (string): Unique chunk identifier
- `book_content_id` (string): Reference to parent BookContent
- `content` (string): Chunked text content
- `chunk_index` (number): Position in the original content (0-based)
- `semantic_boundary` (string): Indicates if this is a section boundary (h1/h2/h3)
- `word_count` (number): Word count of the chunk
- `char_count` (number): Character count of the chunk
- `section_title` (string): Title of the section this chunk belongs to
- `chapter_title` (string): Title of the chapter this chunk belongs to
- `created_at` (string): Timestamp when chunk was created

**Validation Rules**:
- `id` must be unique across all ContentChunk entities
- `book_content_id` must reference an existing BookContent
- `content` must not be empty
- `word_count` and `char_count` must be positive numbers
- `chunk_index` must be a non-negative integer

### EmbeddingVector
Represents the numerical vector representation of a content chunk, generated by the Cohere model.

**Fields**:
- `id` (string): Unique identifier for the vector record
- `chunk_id` (string): Reference to ContentChunk
- `vector` (array<number>): The embedding vector values (typically 1024-dimensional)
- `model` (string): Embedding model used (e.g., "embed-multilingual-v3.0")
- `model_version` (string): Version of the embedding model
- `timestamp` (string): When the embedding was generated
- `embedding_text_length` (number): Length of text that was embedded

**Validation Rules**:
- `id` must be unique across all EmbeddingVector entities
- `chunk_id` must reference an existing ContentChunk
- `vector` must have the expected dimension (e.g., 1024 for Cohere multilingual model)
- `model` must be a valid supported model name
- All values in `vector` must be numbers

### VectorRecord (Qdrant Payload)
Represents an entry in Qdrant Cloud containing the embedding vector and associated metadata for retrieval.

**Fields**:
- `chunk_id` (string): Reference to ContentChunk
- `content` (string): The original text chunk
- `source_url` (string): URL where content was found
- `chapter` (string): Chapter name/number
- `section` (string): Section name/number
- `word_count` (number): Word count of the chunk
- `chunk_index` (number): Position in the original content
- `similarity_score` (number): For retrieval results (computed at query time)

**Validation Rules**:
- `chunk_id` must match an existing ContentChunk
- `content` must not be empty
- `source_url` must be a valid URL
- `similarity_score` must be between 0 and 1 (for query results)

## Relationships

### BookContent → ContentChunk
- One-to-Many relationship
- BookContent can have multiple ContentChunk entities
- ContentChunk.book_content_id references BookContent.id

### ContentChunk → EmbeddingVector
- One-to-One relationship
- Each ContentChunk has exactly one EmbeddingVector
- EmbeddingVector.chunk_id references ContentChunk.id

## State Transitions

### Content Processing States
- `EXTRACTED`: Content has been extracted from the website
- `CHUNKED`: Content has been divided into chunks
- `EMBEDDED`: Embeddings have been generated for all chunks
- `STORED`: Embeddings have been stored in Qdrant
- `VALIDATED`: Storage has been validated with successful queries

## Constraints

### Content Extraction Constraints
- Each URL should only be extracted once per pipeline run
- Content extraction should preserve semantic structure
- Non-content elements (navigation, headers, footers) should be filtered out

### Chunking Constraints
- Chunk size should be between 100 and 800 words
- Chunks should preserve semantic boundaries (not split paragraphs arbitrarily)
- Overlap between adjacent chunks should be 10-20% to preserve context

### Storage Constraints
- Vector dimensions must match the collection schema
- Each chunk_id must be unique in the Qdrant collection
- Payload size must not exceed Qdrant limits